<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì–¼êµ´ ì¸ì‹ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { text-align: center; font-family: sans-serif; padding: 50px; }
        #webcam-container { margin: 20px auto; width: 400px; height: 300px; background: #eee; border: 2px solid #333; position: relative; }
        video { width: 100%; height: 100%; object-fit: cover; }
        button { padding: 15px 30px; font-size: 18px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; margin-top: 20px; }
        button:hover { background: #0056b3; }
        #status { margin-top: 20px; font-weight: bold; font-size: 20px; }
    </style>
</head>
<body>

<h2>ğŸ‘¤ ì–¼êµ´ ì¸ì‹ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h2>
<p>ì¹´ë©”ë¼ë¥¼ ì‘ì‹œí•˜ê³  ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>

<div id="webcam-container">
    <video id="video" autoplay muted></video>
</div>

<button onclick="captureAndLogin()">ğŸ“¸ ì–¼êµ´ë¡œ ë¡œê·¸ì¸ ì‹œë„</button>

<div id="status">ëŒ€ê¸° ì¤‘...</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
    const video = document.getElementById('video');
    const statusDiv = document.getElementById('status');

    // 1. ì›¹ìº  ì¼œê¸°
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => {
            console.error(err);
            statusDiv.innerText = "ì›¹ìº ì„ ì¼¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í—ˆìš©í•´ì£¼ì„¸ìš”!";
            statusDiv.style.color = "red";
        });

    // 2. ì‚¬ì§„ ì°ì–´ì„œ ì„œë²„ë¡œ ë³´ë‚´ê¸°
    async function captureAndLogin() {
        statusDiv.innerText = "ì¸ì‹ ì¤‘... â³";

        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // í˜„ì¬ ë¹„ë””ì˜¤ í™”ë©´ì„ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
        canvas.getContext('2d').drawImage(video, 0, 0);

        // ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ Base64 ë¬¸ìì—´ë¡œ ë³€í™˜
        const imageData = canvas.toDataURL('image/jpeg');

        try {
            // íŒŒì´ì¬ ì„œë²„ë¡œ ì „ì†¡
            const res = await fetch('/verify-face', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ image: imageData })
            });

            const data = await res.json();

            if (data.status === 'success') {
                statusDiv.innerText = "âœ… " + data.msg;
                statusDiv.style.color = "green";
                alert(data.msg); // ì„±ê³µ ì•Œë¦¼ì°½
            } else {
                statusDiv.innerText = "âŒ " + data.msg;
                statusDiv.style.color = "red";
            }

        } catch (err) {
            console.error(err);
            statusDiv.innerText = "ì„œë²„ ì—°ê²° ì˜¤ë¥˜!";
        }
    }
</script>
</body>
</html>